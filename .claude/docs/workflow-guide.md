# ワークフロー改善ガイド

Claude Codeセッションのトークン効率を改善するための実践ガイド。

---

## 1. Plan Mode活用

選択肢の検討・設計フェーズは **Plan Mode** で行う。

| フェーズ | モード | 理由 |
|---------|--------|------|
| 設計・選択肢検討 | Plan Mode | コード生成なし、トークン50%削減 |
| 実装 | Normal Mode | ツール実行が必要 |

**手順**:
1. `/plan` でPlan Modeに切り替え
2. 選択肢を比較・決定
3. 決定後にNormal Modeで実装開始

---

## 2. 2回質問返しルール

同一の選択肢について **2回質問を返してもまだ決まらない** 場合:

1. `/clear` でコンテキストをリセット
2. 決定事項だけを新セッションに持ち込む
3. 未決定事項はユーザーが整理してから再投入

**なぜ**: 未決定のまま議論を続けるとトークンが指数的に増加する。
早期リセットで無駄な消費を防ぐ。

---

## 3. 構造化プロンプト

指示は **箇条書き・テーブル形式** で記述する。

**効果**: 自然文と比較してトークン約30%削減、圧縮後の情報保持率92%。

### 推奨フォーマット

```markdown
## 目的
- [1行で記述]

## 要件
- 要件A
- 要件B

## 制約
| 項目 | 値 |
|------|-----|
| 対象ファイル | src/hooks/*.py |
| テスト | pytest必須 |
```

### 避けるべきパターン
- 長文の自然言語での説明
- 同じ情報の繰り返し
- 曖昧な表現（「いい感じに」「適当に」）

---

## 4. マルチセッション分割

大きなタスクは **設計 / 実装 / テスト** を別セッションに分割する。

| セッション | 内容 | 効果 |
|-----------|------|------|
| Session 1 | 設計・Plan Mode | コンテキスト最小 |
| Session 2 | 実装（設計結果を入力） | 60%削減/セッション |
| Session 3 | テスト・修正 | 実装コードのみ参照 |

**手順**:
1. Session 1: `/plan` で設計、結果をメモ
2. Session 2: `/clear` → 設計結果を貼り付けて実装
3. Session 3: `/clear` → 実装ファイルパスを指定してテスト

---

## 参考資料

- [Claude Code Best Practices](https://docs.anthropic.com/en/docs/claude-code/best-practices) - Anthropic公式ドキュメント
- [Optimizing Claude Code Token Usage](https://www.sfeir.dev/ia/optimiser-claude-code/) - SFEIR blog
